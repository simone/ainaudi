service: pdf
runtime: python311
env: standard
instance_class: B4

entrypoint: gunicorn -b :$PORT config.wsgi_pdf:application --workers 2 --threads 4

env_variables:
  DJANGO_SETTINGS_MODULE: config.settings_pdf
  GOOGLE_CLOUD_PROJECT: ainaudi-prod
  DEBUG: "false"
  ALLOWED_HOSTS: ".appspot.com,.run.app"

  # Database (Cloud SQL via Unix socket)
  DB_HOST: "/cloudsql/ainaudi-prod:europe-west1:ainaudi-db"
  DB_NAME: "ainaudi_db"
  DB_USER: "postgres"

  # Google Cloud Storage (Media Files)
  USE_GCS: "true"
  GCS_BUCKET_NAME: "ainaudi-documents"
  GS_BUCKET_NAME: "ainaudi-documents"
  GS_DEFAULT_ACL: "publicRead"

  # CORS & CSRF Security
  CORS_ALLOWED_ORIGINS: "https://ainaudi-prod.appspot.com"
  CSRF_TRUSTED_ORIGINS: "https://ainaudi-prod.appspot.com"

  # Frontend URL
  FRONTEND_URL: "https://ainaudi-prod.appspot.com"

  # Feature Flags
  FEATURE_TEMPLATES_ENGINE: "true"

handlers:
  - url: /.*
    script: auto
    secure: always

# Cloud SQL connection
beta_settings:
  cloud_sql_instances: ainaudi-prod:europe-west1:ainaudi-db

# Basic scaling: scale to zero, 1GB RAM (B4)
basic_scaling:
  max_instances: 3
  idle_timeout: 5m
